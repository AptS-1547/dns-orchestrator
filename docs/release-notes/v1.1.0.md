# v1.1.0 发行说明

## 概述

v1.1.0 是一个重大架构重构版本，主要将 DNS 提供商逻辑提取为独立库，并新增 Web 后端支持，为未来的多平台部署奠定基础。

## 新功能

### DNS Provider 独立库

- **独立 crate**：将 DNS 提供商逻辑提取为 `dns-orchestrator-provider` 独立库
- **Feature Flags**：支持按需启用 Provider（`cloudflare`、`aliyun`、`dnspod`、`huaweicloud`、`all-providers`）
- **TLS 后端选择**：支持 `native-tls` 和 `rustls` 两种 TLS 后端，`rustls` 推荐用于 Android 平台
- **统一接口**：`DnsProvider` trait 提供统一的域名和记录管理接口

### Web 后端项目

- **Actix-web 后端**：新增 `src-actix-web` 项目，基于 actix-web 构建 Web API
- **SeaORM 集成**：使用 SeaORM 作为 ORM，支持 MySQL、PostgreSQL、SQLite
- **数据库迁移**：内置 migration 工具，支持数据库版本管理

### 多平台支持

- **前端 Transport 抽象**：新增 `ITransport` 接口，抽象 Tauri IPC 和 HTTP 调用
- **编译时平台切换**：通过 `VITE_PLATFORM` 环境变量在 Tauri 和 Web 模式间切换
- **独立构建脚本**：新增 `dev:web`、`build:web`、`preview:web` 命令

## 改进

### 错误处理系统重构

- **库级错误类型**：`ProviderError` 统一各 Provider 的错误映射，支持：
  - `NetworkError`：网络请求失败
  - `InvalidCredentials`：凭证无效
  - `RecordExists` / `RecordNotFound`：记录冲突
  - `InvalidParameter`：参数无效
  - `QuotaExceeded`：配额超限
  - `DomainNotFound`：域名不存在
  - `ParseError` / `SerializationError`：解析失败
- **应用层简化**：`src-tauri` 的 `DnsError` 直接复用库的 `ProviderError`，通过 `#[from]` 自动转换
- **凭证验证错误结构化**：`CredentialValidationError` 支持字段级别的错误提示

### 服务层架构

- **前端服务层**：新增 `src/services/` 目录，封装所有后端调用
  - `account.service.ts`：账户管理
  - `dns.service.ts`：DNS 记录管理
  - `domain.service.ts`：域名管理
  - `toolbox.service.ts`：工具箱功能
- **类型安全的 CommandMap**：所有 command 的参数和返回值类型在编译时校验

### Rust 升级

- **Edition 2024**：升级 Rust edition 至 2024
- **代码精简**：移除 `src-tauri` 中冗余的 Provider 实现，改为依赖独立库

## 工具链改进

- **版本同步脚本**：`sync-version.mjs` 现同步更新 `src-tauri` 和 `src-actix-web` 的 `Cargo.toml`
- **Web 代理配置**：Web 模式自动配置 `/api` 代理到后端服务

## 升级说明

从 v1.0.12 升级无需额外操作，直接安装新版本即可。

如需使用 Web 模式开发：
```bash
# 开发模式
pnpm dev:web

# 生产构建
pnpm build:web
```
