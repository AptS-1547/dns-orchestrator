# v1.6.0 发行说明

## 概述

v1.6.0 是一个重大功能增强版本，为工具箱模块新增三项专业网络诊断工具（HTTP 头检查、DNS 传播检查、DNSSEC 验证），并完成 SSL 检查底层技术栈的现代化重构。本版本通过移动端响应式优化和大规模代码重构，显著提升了用户体验和代码质量。

## 新增功能

### 🌐 HTTP 头检查

全新的 HTTP 请求/响应诊断工具，提供深度协议分析：

**核心功能**：
- 自定义 HTTP 方法（GET/POST/PUT/DELETE 等）
- 灵活的请求头配置（支持自定义头部）
- 请求体编辑（支持 JSON/表单数据等）
- 原始请求/响应报文查看与复制
- 安全头分析（自动检测 17+ 项安全头配置）

**安全头检测项**：
- 必需安全头：`Strict-Transport-Security`、`X-Content-Type-Options`、`X-Frame-Options`、`Content-Security-Policy`
- 建议安全头：`Permissions-Policy`、`Referrer-Policy`、`Cross-Origin-*` 系列等
- 智能评估：区分必需/建议/已配置/未配置状态

**技术实现**：
- 使用 `url` 库正确解析 Host 头
- 支持自定义端口（含端口验证）
- 查询历史记录持久化

### 🌍 DNS 传播检查

全球 DNS 传播状态实时监测工具，助力域名配置验证：

**服务器覆盖**（12 个全球节点）：
- 北美：Google、Cloudflare、Quad9
- 亚洲：阿里云、腾讯云、DNSPod、CNNIC
- 欧洲：AdGuard
- 大洋洲：Telstra Corporation Ltd
- 其他：OpenDNS、Comodo Secure DNS、Level3

**核心特性**：
- 并发查询所有服务器（异步实现）
- 智能一致性计算（自动忽略 TTL 差异）
- 可视化传播进度（进度条组件）
- 传播状态评估（完全传播/部分传播/未传播）
- 支持所有 DNS 记录类型（A/AAAA/MX/CNAME/TXT/NS/SOA 等）

**技术亮点**：
- 查询超时时间提取为常量（可配置）
- 准确的结果去重和比较逻辑
- 失败服务器自动标记

### 🔐 DNSSEC 验证

专业的 DNSSEC 安全验证工具，确保域名解析可信性：

**支持记录类型**：
- DNSKEY：域名密钥记录（含算法、公钥、标志位）
- DS：委托签名者记录（含密钥标签、算法、摘要）
- RRSIG：资源记录签名（含签名者、有效期、签名值）

**验证状态**：
- `Secure`：DNSSEC 验证成功，签名有效
- `Insecure`：未启用 DNSSEC（无记录）
- `Bogus`：签名验证失败，可能存在篡改
- `Indeterminate`：状态不确定（部分记录存在）

**技术实现**：
- 启用 `hickory-resolver` 的 `dnssec-ring` 特性
- 使用 `hex` 编码库格式化密钥/摘要
- 提取 `extract_signature_record` 函数消除代码重复
- 详细调试日志（记录验证状态和记录数量）

**UI 增强**：
- 状态徽章可视化（色彩区分四种状态）
- 长文本字段自动截断（含完整显示功能）
- 等宽字体展示公钥/摘要（提升可读性）

## 技术改进

### SSL 检查底层重构

完成从 `native-tls` 到 `rustls` 的彻底迁移，提升跨平台兼容性和现代化程度：

**技术栈升级**：
- 统一使用 `rustls` 作为 TLS 后端（移除 native-tls 依赖）
- 引入 `aws-lc-rs` 作为加密后端（增强跨平台支持）
- 重构为纯异步实现（使用 `tokio-rustls`）

**功能改进**：
- 优化证书链获取逻辑（支持完整证书链解析）
- 增强超时处理（分离 TCP 连接、TLS 握手、HTTP 检测超时）
- 移除冗余的 HTTP 请求（简化握手流程）

**可观测性提升**：
- 添加关键步骤日志（debug/trace/warn 级别）
- 记录操作耗时（便于性能监控）
- 增强错误场景日志输出（连接失败、超时、证书问题）

**错误处理**：
- 将 `CryptoProvider::install_default` 错误从静默忽略改为显式处理
- 简化变量绑定（移除不必要的可变性）

### 移动端响应式优化

为工具箱模块全面适配移动端，提升小屏幕设备体验：

**组件切换**：
- 桌面端：保持 Tabs 选项卡布局
- 移动端：使用 Accordion 折叠面板（添加 `@radix-ui/react-accordion` 依赖）

**新增 UI 组件**：
- `accordion.tsx`：折叠面板组件
- `progress.tsx`：进度条组件（用于 DNS 传播一致性展示）
- `textarea.tsx`：多行文本输入组件（用于 HTTP 请求体）

### 代码质量提升

大规模重构和性能优化，减少技术债务：

**性能优化**：
- 使用 `React.memo` 包装共享组件（减少重复渲染）
- 添加 `useMemo` 缓存计算结果
- 优化列表渲染（使用稳定键值替代索引）

**逻辑复用**：
- 新增 `useCopyToClipboard` 自定义 Hook（统一复制功能）
- 新增 `useEnterKeyHandler` 自定义 Hook（统一回车键处理）
- 新增 `useToolboxQuery` 自定义 Hook（统一加载状态和错误提示）

**类型系统重构**：
- 移除冗余的类型转换函数（直接复用 core 类型）
- 删除 `src-tauri/src/types.rs` 中的重复定义（减少 128 行）
- 简化前端组件键值生成逻辑（避免重复键警告）

**代码清理**：
- 净减少约 652 行重复代码
- 统一 CSS 类名顺序（提高一致性）
- 清理导入顺序（移除未使用的图标）

### 用户体验增强

多项细节改进，提升易用性：

**历史记录增强**：
- 新增确认对话框（防止误删）
- 支持按类型清除历史（单独清除 DNS/WHOIS/IP 等）
- 添加操作反馈（删除成功提示）

**HTTP 头管理**：
- 改进自定义头部管理界面
- 添加历史记录支持
- 集成国际化文本（复制、展开/收起按钮）

**工具函数**：
- 新增端口验证工具函数（`src/utils/validation.ts`）
- 完善国际化翻译（中英文全覆盖）

## 技术统计

- **新增文件**：17 个
  - Rust 核心模块：3 个（dns_propagation.rs, dnssec.rs, http_headers.rs）
  - React 组件：6 个（DnsPropagation.tsx, DnssecCheck.tsx, HttpHeaderCheck.tsx, HeaderItem.tsx, 3 个 UI 组件）
  - 自定义 Hooks：2 个（useCopyToClipboard.ts, useEnterKeyHandler.ts）
  - 类型定义：1 个（toolbox.rs）
  - 其他：5 个

- **修改文件**：26 个
- **新增代码**：+3,469 行
- **删除代码**：-796 行
- **净增加**：+2,673 行

**依赖变更**：
- 新增：`url`（HTTP 头解析）、`hex`（DNSSEC 十六进制编码）、`aws-lc-rs`（rustls 加密后端）
- 新增前端：`@radix-ui/react-accordion`
- 移除：`native-tls`

## 升级说明

从 v1.5.2 升级无需额外操作，直接安装新版本即可。

**注意事项**：
1. SSL 检查底层已从 native-tls 迁移到 rustls，首次使用时会初始化加密提供者
2. 新增的三个工具箱功能支持历史记录持久化，数据存储在应用本地
3. 移动端用户现可使用折叠面板布局，体验更加流畅

**破坏性变更**：
- 无（向后兼容）

## 已知问题

- DNS 传播检查中，部分国内 DNS 服务器可能因网络环境超时（已添加超时处理）
- DNSSEC 验证状态为 `Bogus` 时，暂不提供详细的失败原因（需 hickory-resolver 上游支持）

## 致谢

感谢以下开源项目：
- `rustls`、`tokio-rustls`、`aws-lc-rs`：现代化 TLS 实现
- `hickory-resolver`：强大的 DNS 解析库
- `@radix-ui/react-accordion`：无障碍的折叠面板组件
- `url`：Rust URL 解析标准库

## 下一步计划

- 添加更多网络工具（Ping、Traceroute、端口扫描）
- 支持工具箱结果导出（JSON/CSV）
- 增强 DNSSEC 验证（显示详细的签名链）

---

**完整变更日志**：[v1.5.2...v1.6.0](https://github.com/AptS-1547/dns-orchestrator/compare/v1.5.2...v1.6.0)
